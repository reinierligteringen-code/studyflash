<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Study Suite ‚Äî Home</title>
  <link rel="stylesheet" href="style.css"/>
  <script src="sets.js"></script>
  <style>
    header { position: static; border-bottom: none; background: transparent; }
    header .wrap { max-width: 960px; margin: 0 auto; padding: 36px 16px 12px; display:flex; flex-direction:column; gap:8px; }
    header h1 { font-size: 32px; letter-spacing: 0.4px; }
    header p { margin: 0; color: var(--muted); max-width: 640px; }
    main { max-width: 960px; margin: 0 auto; padding: 0 16px 80px; display:flex; flex-direction:column; gap:32px; }
    .actions { display:grid; gap:12px; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); }
    .card-link {
      display:flex;
      flex-direction:column;
      gap:6px;
      border:1px solid var(--border);
      border-radius:14px;
      padding:18px 20px;
      background:var(--surface);
      text-decoration:none;
      color:var(--text);
      box-shadow:var(--shadow-sm);
      transition: transform 140ms ease, box-shadow 140ms ease;
    }
    .card-link span { color: var(--muted); font-size: 13px; }
    .card-link:hover { transform: translateY(-2px); box-shadow:var(--shadow-md); }
    .recent-header { display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    .recent-header h2 { margin:0; font-size:20px; }
    .btn { padding:9px 12px; border-radius:10px; text-decoration:none; cursor:pointer; display:inline-flex; align-items:center; gap:6px; }
    .btn:hover { transform: translateY(-1px); box-shadow:var(--shadow-sm); }
    .actions-inline { display:flex; gap:8px; flex-wrap:wrap; }
    .sets-list { display:grid; gap:12px; }
    .set-card { border:1px solid var(--border); border-radius:14px; padding:14px 16px; background:var(--surface); box-shadow:var(--shadow-sm); display:flex; flex-wrap:wrap; align-items:center; justify-content:space-between; gap:14px; }
    .set-info { display:flex; flex-direction:column; gap:4px; }
    .set-info .muted { font-size:12px; }
    .set-actions { display:flex; gap:8px; flex-wrap:wrap; }
    .empty { border:1px dashed var(--border); padding:18px; border-radius:14px; color:var(--muted); background:rgba(255,255,255,0.8); text-align:center; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Study Suite</h1>
      <p>Draw rich flashcards, manage decks, and rehearse in the browser. Everything stays on your device unless you export it.</p>
    </div>
  </header>
  <main>
    <section>
      <div class="actions">
        <a class="card-link" href="manage.html">
          <strong>Manage Sets</strong>
          <span>Create, rename, delete, import, or export decks stored in this browser.</span>
        </a>
        <a class="card-link" href="rehearse.html">
          <strong>Rehearse</strong>
          <span>Flip through your cards with keyboard shortcuts and shuffle when needed.</span>
        </a>
        <a class="card-link" id="open-default" href="editor.html">
          <strong>Open Editor</strong>
          <span>Jump straight into drawing mode for the most recent set.</span>
        </a>
      </div>
    </section>

    <section>
      <div class="recent-header">
        <h2>Recent Sets</h2>
        <div class="actions-inline">
          <button class="btn" id="btn-new-set">‚ûï New set</button>
          <a class="btn" href="manage.html">Open manager</a>
        </div>
      </div>
      <div id="sets-list" class="sets-list"></div>
    </section>
  </main>

  <script>
    const setsList = document.getElementById('sets-list');
    const openDefaultLink = document.getElementById('open-default');
    const btnNewSet = document.getElementById('btn-new-set');

    async function renderSets() {
      setsList.innerHTML = '';
      let sets = [];
      if (window.SetsAPI) {
        try {
          sets = await SetsAPI.loadSets();
        } catch (err) {
          console.error('Unable to load sets', err);
        }
      }
      sets = Array.isArray(sets) ? [...sets].sort((a, b) => a.createdAt - b.createdAt) : [];

      if (!sets.length) {
        const empty = document.createElement('div');
        empty.className = 'empty';
        empty.textContent = 'No sets yet. Create one to get started!';
        setsList.appendChild(empty);
        openDefaultLink.href = 'editor.html';
        openDefaultLink.querySelector('span').textContent = 'Jump straight into drawing mode.';
        return;
      }

      const latest = sets[sets.length - 1];
      openDefaultLink.href = `editor.html?set=${encodeURIComponent(latest.id)}`;
      openDefaultLink.querySelector('span').textContent = `Continue editing ‚Äú${latest.name}‚Äù.`;

      for (const set of sets) {
        const card = document.createElement('div');
        card.className = 'set-card';
        card.innerHTML = `
          <div class="set-info">
            <strong>${set.name}</strong>
            <span class="muted">${set.id}</span>
          </div>
          <div class="set-actions">
            <a class="btn" href="editor.html?set=${encodeURIComponent(set.id)}">‚úèÔ∏è Edit</a>
            <a class="btn" href="rehearse.html?set=${encodeURIComponent(set.id)}">üìñ Rehearse</a>
            <a class="btn" href="cards.html?set=${encodeURIComponent(set.id)}">üóÇ Cards</a>
          </div>
        `;
        setsList.appendChild(card);
      }
    }

    btnNewSet.addEventListener('click', async () => {
      if (!window.SetsAPI) return;
      const name = prompt('Name for the new set:', 'New Set');
      if (name === null) return;
      try {
        const set = await SetsAPI.createSet(name.trim() || 'New Set');
        await renderSets();
        location.href = `editor.html?set=${encodeURIComponent(set.id)}`;
      } catch (err) {
        alert('Unable to create set right now. Please try again.');
        console.error(err);
      }
    });

    renderSets();
  </script>
</body>
</html>
